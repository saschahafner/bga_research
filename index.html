<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Board Game Search</title>
</head>
<body>
    <h1>Board Game Search</h1>
    <form id="search-form">
        <input type="text" id="boardgame-name" placeholder="Enter board game name" required>
        <button type="submit">Search</button>
    </form>
    <div id="result"></div>

    <script>
        const searchForm = document.getElementById('search-form');
        const gameNameInput = document.getElementById('boardgame-name');
        const resultDiv = document.getElementById('result');

        searchForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const gameName = gameNameInput.value;
            resultDiv.innerHTML = 'Searching...';

            try {
                const searchResponse = await fetch(`/search?name=${encodeURIComponent(gameName)}`);
                if (!searchResponse.ok) {
                    const error = await searchResponse.json();
                    throw new Error(error.message);
                }
                const games = await searchResponse.json();

                if (games.length === 1) {
                    fetchDescription(games[0].id);
                } else {
                    displayGameList(games);
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        });

        function displayGameList(games) {
            resultDiv.innerHTML = '<h2>Please select a game:</h2>';
            const ul = document.createElement('ul');
            games.forEach(game => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = '#';
                a.textContent = game.name;
                a.dataset.id = game.id;
                a.addEventListener('click', (event) => {
                    event.preventDefault();
                    fetchDescription(event.target.dataset.id);
                });
                li.appendChild(a);
                ul.appendChild(li);
            });
            resultDiv.appendChild(ul);
        }

        async function fetchDescription(gameId) {
            resultDiv.innerHTML = 'Fetching description...';
            try {
                const response = await fetch(`/game/${gameId}`);
                if (!response.ok) {
                    throw new Error(await response.text());
                }
                const description = await response.text();
                resultDiv.innerHTML = description;
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
